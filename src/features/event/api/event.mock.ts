import type { CalendarSlide } from "../types/event.types";

/**
 * Always normalize date to YYYY-MM-DD
 */
function normalizeDate(dateISO: string): string {
    return dateISO.slice(0, 10);
}

/**
 * Add days to a YYYY-MM-DD date string
 */
export function addDays(dateISO: string, days: number): string {
    const d = new Date(normalizeDate(dateISO));
    d.setDate(d.getDate() + days);
    return d.toISOString().slice(0, 10);
}

/**
 * Format date for UI
 */
export function formatDate(dateISO: string) {
    const normalized = normalizeDate(dateISO);
    const d = new Date(normalized);

    return {
        iso: normalized,
        day: String(d.getDate()).padStart(2, "0"),
        month: d.toLocaleString("en", { month: "long" }),
        weekday: d.toLocaleString("en", { weekday: "long" }),
    };
}

/**
 * Mock DB (KEYS MUST BE YYYY-MM-DD)
 */
const MOCK_DB: Record<string, Omit<CalendarSlide, "date">> = {
    "2026-01-01": {
        title: "თბილისის დაარსება",
        text: "ლეგენდის მიხედვით, მეფე ვახტანგ გორგასალმა V საუკუნეში დააარსა თბილისი. გადმოცემის თანახმად, ნადირობის დროს მეფის მიმინოს დაჭრილი ხოხობი ცხელი წყაროს წყალში ჩავარდა. ამ აღმოჩენამ ვახტანგი იმდენად აღაფრთოვანა, რომ მან ამ ადგილზე ქალაქის აშენება გადაწყვიტა. თბილისი სწრაფად იქცა პოლიტიკურ და კულტურულ ცენტრად, რომელიც საუკუნეების განმავლობაში მნიშვნელოვან როლს ასრულებდა საქართველოს ისტორიაში.",
        image: "https://picsum.photos/id/1011/600/400",
    },
    "2026-01-02": {
        title: "ვახტანგ გორგასალი",
        text: "ვახტანგ I გორგასალი ერთ-ერთი ყველაზე გამორჩეული მეფეა საქართველოს ისტორიაში. მისი მმართველობის პერიოდში გაძლიერდა სახელმწიფო და ჩამოყალიბდა ძლიერი პოლიტიკური ცენტრი. ვახტანგი ცნობილია როგორც მამაცი მეომარი და რეფორმატორი, რომელმაც დიდი ყურადღება დაუთმო ეკლესიის გაძლიერებასა და ქვეყნის ადმინისტრაციულ მოწყობას. მისი სახელი დღემდე ასოცირდება სახელმწიფოებრიობისა და ერთიანობის იდეასთან.",
        image: "https://picsum.photos/id/1012/600/400",
    },
    "2026-01-03": {
        title: "კოლხეთის სამეფო",
        text: "კოლხეთის სამეფო ერთ-ერთი უძველესი სახელმწიფო წარმონაქმნი იყო საქართველოს ტერიტორიაზე. ის მდებარეობდა შავი ზღვის აღმოსავლეთ სანაპიროზე და მნიშვნელოვან როლს ასრულებდა სავაჭრო და კულტურულ ურთიერთობებში. კოლხეთი ცნობილი იყო თავისი სიმდიდრით, მეტალურგიითა და განვითარებული ხელოსნობით. სწორედ კოლხეთს უკავშირდება მრავალი მითოლოგიური და ისტორიული თხრობა.",
        image: "https://picsum.photos/id/1013/600/400",
    },
    "2026-01-04": {
        title: "ოქროს საწმისის ლეგენდა",
        text: "ოქროს საწმისის ლეგენდა ერთ-ერთი ყველაზე ცნობილი მითია, რომელიც კოლხეთის სამეფოს უკავშირდება. ბერძნული მითოლოგიის მიხედვით, იაზონი და არგონავტები კოლხეთში ჩამოვიდნენ ოქროს საწმისის მოსაპოვებლად. ეს მითი ასახავს კოლხეთის სიმდიდრესა და მის მნიშვნელობას ძველ სამყაროში. ლეგენდა დღემდე წარმოადგენს საქართველოს კულტურული მემკვიდრეობის ნაწილს.",
        image: "https://picsum.photos/id/1015/600/400",
    },
    "2026-01-05": {
        title: "ქრისტიანობის მიღება",
        text: "საქართველომ ქრისტიანობა სახელმწიფო რელიგიად IV საუკუნეში მიიღო, რაც ქვეყნის ისტორიის უმნიშვნელოვანესი მოვლენა იყო. ეს ნაბიჯი დიდწილად განსაზღვრავდა ქვეყნის კულტურულ და სულიერ განვითარებას. ქრისტიანობის მიღებამ ხელი შეუწყო ეკლესიის გაძლიერებას, განათლების გავრცელებას და ერთიანი ეროვნული იდენტობის ჩამოყალიბებას.",
        image: "/assets/plane.png",
    },
    "2026-01-06": {
        title: "წმინდა ნინო",
        text: "წმინდა ნინო ქრისტიანობის გავრცელების მთავარი ფიგურაა საქართველოში. მისი მოღვაწეობა გამოირჩეოდა სიმტკიცით, რწმენითა და თავგანწირვით. გადმოცემის მიხედვით, წმინდა ნინომ მეფე მირიანი და დედოფალი ნანა მოაქცია ქრისტიანობაზე. მისი საქმიანობა საფუძვლად დაედო ქართული ეკლესიის ჩამოყალიბებას.",
        image: "https://picsum.photos/id/1018/600/400",
    },
    "2026-01-07": {
        title: "ბაგრატ III-ის გამეფება",
        text: "ბაგრატ III-ის გამეფება 1008 წელს საქართველოს ისტორიაში გარდამტეხი მოვლენა იყო. მან შეძლო სხვადასხვა ქართული სამეფოს გაერთიანება ერთ ძლიერ სახელმწიფოდ. ეს პროცესი რთული და ხანგრძლივი იყო, თუმცა საბოლოოდ საფუძველი ჩაეყარა ერთიან ქართულ მონარქიას, რომელმაც შემდგომში მნიშვნელოვანი პოლიტიკური და კულტურული წარმატებები მოიტანა.",
        image: "https://picsum.photos/id/1020/600/400",
    },
    "2026-01-08": {
        title: "საქართველოს ოქროს ხანა",
        text: "საქართველოს ოქროს ხანა ქვეყნის ისტორიის უმაღლესი აყვავების პერიოდად ითვლება. ეს ეპოქა უკავშირდება დავით აღმაშენებლისა და თამარ მეფის მმართველობას. ამ დროს საქართველო ძლიერი სამხედრო, ეკონომიკური და კულტურული ცენტრი გახდა რეგიონში. განვითარდა მეცნიერება, ხელოვნება და არქიტექტურა.",
        image: "https://picsum.photos/id/1021/600/400",
    },
    "2026-01-09": {
        title: "დავით აღმაშენებელი",
        text: "დავით IV აღმაშენებელი ერთ-ერთი უდიდესი ქართველი მეფეა. მან გაატარა მნიშვნელოვანი სამხედრო და ადმინისტრაციული რეფორმები, რომლებიც სახელმწიფოს გაძლიერებას ემსახურებოდა. დავითის მმართველობისას საქართველო გადაიქცა ძლიერ და დამოუკიდებელ სახელმწიფოდ, რომელმაც წარმატებით გაუძლო გარე საფრთხეებს.",
        image: "https://picsum.photos/id/1022/600/400",
    },
    "2026-01-10": {
        title: "დიდგორის ბრძოლა",
        text: "დიდგორის ბრძოლა 1121 წელს საქართველოს ისტორიის ერთ-ერთი უმნიშვნელოვანესი სამხედრო გამარჯვებაა. ქართველთა შედარებით მცირე ჯარმა დაამარცხა მრავალრიცხოვანი სელჩუკური ლაშქარი. ამ გამარჯვებამ საბოლოოდ განამტკიცა საქართველოს დამოუკიდებლობა და გზა გაუხსნა ქვეყნის ოქროს ხანას.",
        image: "https://picsum.photos/id/1024/600/400",
    },
    "2026-01-11": {
        title: "თამარ მეფე",
        text: "თამარ მეფე საქართველოს ისტორიაში ერთ-ერთი ყველაზე გამორჩეული მმართველია. მისი მეფობის პერიოდში ქვეყანა ძლიერ და სტაბილურ სახელმწიფოდ ჩამოყალიბდა. თამარის მმართველობა გამოირჩეოდა პოლიტიკური სიბრძნით, დიპლომატიითა და კულტურის მხარდაჭერით.",
        image: "https://picsum.photos/id/1025/600/400",
    },
    "2026-01-12": {
        title: "ვარძია",
        text: "ვარძია უნიკალური კლდეში ნაკვეთი ქალაქია, რომელიც თამარ მეფის ეპოქაში შეიქმნა. იგი მოიცავს ასეულობით გამოქვაბულს, ეკლესიასა და საცხოვრებელ სივრცეებს. ვარძია არა მხოლოდ თავდაცვითი ნაგებობა, არამედ კულტურული და სულიერი ცენტრი იყო.",
        image: "https://picsum.photos/id/1026/600/400",
    },
    "2026-01-13": {
        title: "ქართული ანბანი",
        text: "ქართული ანბანი ერთ-ერთი უძველესი და უნიკალური დამწერლობის სისტემაა მსოფლიოში. მას სამი ისტორიული ფორმა აქვს და იგი მნიშვნელოვან კულტურულ მემკვიდრეობას წარმოადგენს. ანბანი ასახავს ქართული ენის სიღრმესა და ისტორიულ განვითარებას.",
        image: "https://picsum.photos/id/1027/600/400",
    },
    "2026-01-14": {
        title: "შოთა რუსთაველი",
        text: "შოთა რუსთაველი შუა საუკუნეების ქართული ლიტერატურის უდიდესი წარმომადგენელია. მისი ეპოსი „ვეფხისტყაოსანი“ ქართული კულტურის უმნიშვნელოვანესი ნაწარმოებია. ეს პოემა ასახავს სიყვარულს, მეგობრობასა და ღირსების იდეალებს.",
        image: "https://picsum.photos/id/1028/600/400",
    },
    "2026-01-15": {
        title: "მონღოლთა შემოსევები",
        text: "XIII საუკუნეში მონღოლთა შემოსევებმა მძიმე დარტყმა მიაყენა საქართველოს. ქვეყანა განიცდიდა ეკონომიკურ და დემოგრაფიულ ზარალს. მიუხედავად ამისა, ქართულმა სახელმწიფოებრიობამ შეძლო გადარჩენა და ეტაპობრივი აღდგენა.",
        image: "https://picsum.photos/id/1029/600/400",
    },
    "2026-01-16": {
        title: "სამეფოს დაშლა",
        text: "გვიან შუა საუკუნეებში საქართველო რამდენიმე დამოუკიდებელ სამეფოდ დაიშალა. ეს პერიოდი ხასიათდებოდა შიდა დაპირისპირებებითა და გარე ზეწოლით. ქვეყნის ერთიანობის დაკარგვამ მნიშვნელოვნად შეასუსტა სახელმწიფო.",
        image: "https://picsum.photos/id/1036/600/400",
    },
    "2026-01-17": {
        title: "გიორგი ბრწყინვალე",
        text: "გიორგი V ბრწყინვალე ერთ-ერთი მეფეა, რომელმაც ქვეყნის აღდგენა შეძლო მძიმე პერიოდის შემდეგ. მან განდევნა მონღოლთა ბატონობა და გააძლიერა სახელმწიფოებრივი მართვა. მისი მმართველობა სტაბილურობის აღდგენას უკავშირდება.",
        image: "https://picsum.photos/id/1031/600/400",
    },
    "2026-01-18": {
        title: "ოსმალთა და სპარსთა ზეწოლა",
        text: "საქართველო საუკუნეების განმავლობაში ოსმალეთისა და სპარსეთის დაპირისპირების არენად იქცა. მუდმივმა ომებმა და ზეწოლამ ქვეყნის განვითარება შეაფერხა. მიუხედავად ამისა, ქართველმა ხალხმა შეძლო ეროვნული იდენტობის შენარჩუნება.",
        image: "https://picsum.photos/id/1032/600/400",
    },
    "2026-01-19": {
        title: "ერეკლე II",
        text: "ერეკლე II XVIII საუკუნეში ქართული სახელმწიფოს გაძლიერებას ცდილობდა. მან გაატარა რეფორმები და იბრძოდა ქვეყნის დამოუკიდებლობისთვის. მისი მმართველობა რთული პოლიტიკური გარემოთი ხასიათდებოდა.",
        image: "https://picsum.photos/id/1033/600/400",
    },
    "2026-01-20": {
        title: "თანამედროვე საქართველო",
        text: "საქართველომ დამოუკიდებლობა 1991 წელს გამოაცხადა. ამის შემდეგ ქვეყანამ რთული გზა გაიარა სახელმწიფოებრივი განვითარების, რეფორმებისა და საერთაშორისო ინტეგრაციის მიმართულებით. თანამედროვე საქართველო აგრძელებს საკუთარი იდენტობისა და დემოკრატიული ღირებულებების განმტკიცებას.",
        image: "https://picsum.photos/id/1035/600/400",
    },
};


/**
 * Build single slide
 */
function buildSlide(dateISO: string): CalendarSlide {
    const normalized = normalizeDate(dateISO);

    const data =
        MOCK_DB[normalized] ?? {
            title: "No events",
            text: "No historical data for this date.",
            image: "/assets/nothing-found.svg",
        };

    return {
        date: formatDate(normalized),
        ...data,
    };
}

/**
 * Mock API
 * Always accepts ISO OR YYYY-MM-DD
 * Always returns normalized data
 */
export async function fetchCalendarSlidesMock(dateISO: string) {
    const normalized = normalizeDate(dateISO);

    return {
        prev: buildSlide(addDays(normalized, -1)),
        current: buildSlide(normalized),
        next: buildSlide(addDays(normalized, 1)),
    };
}

/**
 * Mock API for getArticles
 * Returns a month's worth of articles with dates as keys
 * @param dateISO The date in ISO format or YYYY-MM-DD
 * @returns Mock response with dates as keys and article objects or null as values
 */
export async function getArticlesMock(dateISO: string) {
    const normalized = normalizeDate(dateISO);
    const date = new Date(normalized);
    const year = date.getFullYear();
    const month = date.getMonth() + 1;

    // Get the number of days in the month
    const daysInMonth = new Date(year, month, 0).getDate();

    // Create a response object with all days in the month
    const data: Record<string, any> = {};

    for (let day = 1; day <= daysInMonth; day++) {
        const dayStr = String(day).padStart(2, '0');
        const dateKey = `${year}-${String(month).padStart(2, '0')}-${dayStr}`;

        // Check if we have mock data for this date
        if (MOCK_DB[dateKey]) {
            const mockData = MOCK_DB[dateKey];
            data[dateKey] = {
                id: day,
                date: dateKey,
                imagePath: mockData.image,
                title: mockData.title,
                description: mockData.text
            };
        } else {
            // No data for this date
            data[dateKey] = null;
        }
    }

    return {
        data,
        status: 200,
        statusText: "OK",
        headers: {},
        config: {}
    };
}
